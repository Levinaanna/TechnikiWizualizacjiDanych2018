<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>D3PD10 - Mateusz Polakowski</title>

 		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<style type="text/css">
			svg {
				font: 10px sans-serif;
				shape-rendering: crispEdges;
			}
			.axis path,
			.axis line {
				fill: none;
				strke: #000;
			}
		 
			path.domain {
				stroke: none;
			}
			.y .tick line {
				stroke: #ddd;
			}
		   
			div#layout {
				text-align: center;
			}
			.rimage .center {
				text-align: center;
			}
			
			svg {
				display: block;
				margin: 0 auto;
			}	
		</style>
	</head>
    <body>
		<center>
			<h1>
				PD10 - Mateusz Polakowski
			</h1>
			<h3>
                Poniższy wykres przedstawia różnice między liczbą żyjących kobiet a mężczyzn w 2009 roku. 
			</h3>
			<h4>
				Ponieważ pierwsza grupa przeważała w każdym wieku, to fakt ten zaznaczono czerwonym kolorem, podkreślając jaka to dokładnie jest liczba (wyświetlający się tooltip po najechaniu kursorem na słupek). 
			<br>
				Ponadto, jeśli odbiorca nie chce widzieć danej cześci słupka, to po kliknięciu powoduje, że wskazana znika.
			</h4>
		</center>
		<br> <br>
        <script type="text/javascript">
            
            var data = [{"Age":0,"txM":7148455,"roznica":843229},{"Age":1,"txM":7049023,"roznica":843135},{"Age":2,"txM":6949644,"roznica":843037},{"Age":3,"txM":6850296,"roznica":842933},{"Age":4,"txM":6750968,"roznica":842827},{"Age":5,"txM":6651653,"roznica":842726},{"Age":6,"txM":6552355,"roznica":842620},{"Age":7,"txM":6453075,"roznica":842508},{"Age":8,"txM":6353808,"roznica":842398},{"Age":9,"txM":6254557,"roznica":842287},{"Age":10,"txM":6155321,"roznica":842172},{"Age":11,"txM":6056101,"roznica":842053},{"Age":12,"txM":5956894,"roznica":841931},{"Age":13,"txM":5857703,"roznica":841806},{"Age":14,"txM":5758528,"roznica":841682},{"Age":15,"txM":5659376,"roznica":841555},{"Age":16,"txM":5560260,"roznica":841415},{"Age":17,"txM":5461185,"roznica":841256},{"Age":18,"txM":5362166,"roznica":841064},{"Age":19,"txM":5263229,"roznica":840818},{"Age":20,"txM":5164392,"roznica":840498},{"Age":21,"txM":5065664,"roznica":840094},{"Age":22,"txM":4967048,"roznica":839602},{"Age":23,"txM":4868542,"roznica":839025},{"Age":24,"txM":4770149,"roznica":838360},{"Age":25,"txM":4671862,"roznica":837617},{"Age":26,"txM":4573679,"roznica":836795},{"Age":27,"txM":4475604,"roznica":835890},{"Age":28,"txM":4377640,"roznica":834902},{"Age":29,"txM":4279786,"roznica":833835},{"Age":30,"txM":4182046,"roznica":832690},{"Age":31,"txM":4084434,"roznica":831456},{"Age":32,"txM":3986966,"roznica":830119},{"Age":33,"txM":3889647,"roznica":828678},{"Age":34,"txM":3792486,"roznica":827125},{"Age":35,"txM":3695496,"roznica":825450},{"Age":36,"txM":3598700,"roznica":823639},{"Age":37,"txM":3502106,"roznica":821692},{"Age":38,"txM":3405725,"roznica":819597},{"Age":39,"txM":3309588,"roznica":817332},{"Age":40,"txM":3213730,"roznica":814880},{"Age":41,"txM":3118176,"roznica":812226},{"Age":42,"txM":3022961,"roznica":809349},{"Age":43,"txM":2928126,"roznica":806217},{"Age":44,"txM":2833684,"roznica":802825},{"Age":45,"txM":2739657,"roznica":799166},{"Age":46,"txM":2646101,"roznica":795205},{"Age":47,"txM":2553060,"roznica":790923},{"Age":48,"txM":2460595,"roznica":786277},{"Age":49,"txM":2368772,"roznica":781228},{"Age":50,"txM":2277634,"roznica":775763},{"Age":51,"txM":2187252,"roznica":769838},{"Age":52,"txM":2097703,"roznica":763415},{"Age":53,"txM":2009038,"roznica":756474},{"Age":54,"txM":1921334,"roznica":748963},{"Age":55,"txM":1834668,"roznica":740841},{"Age":56,"txM":1749106,"roznica":732077},{"Age":57,"txM":1664725,"roznica":722634},{"Age":58,"txM":1581620,"roznica":712466},{"Age":59,"txM":1499894,"roznica":701513},{"Age":60,"txM":1419613,"roznica":689751},{"Age":61,"txM":1340848,"roznica":677164},{"Age":62,"txM":1263685,"roznica":663729},{"Age":63,"txM":1188201,"roznica":649423},{"Age":64,"txM":1114498,"roznica":634184},{"Age":65,"txM":1042626,"roznica":617998},{"Age":66,"txM":972687,"roznica":600827},{"Age":67,"txM":904742,"roznica":582669},{"Age":68,"txM":838801,"roznica":563559},{"Age":69,"txM":774955,"roznica":543468},{"Age":70,"txM":713321,"roznica":522365},{"Age":71,"txM":653995,"roznica":500267},{"Age":72,"txM":597031,"roznica":477227},{"Age":73,"txM":542495,"roznica":453286},{"Age":74,"txM":490461,"roznica":428505},{"Age":75,"txM":441007,"roznica":402999},{"Age":76,"txM":394206,"roznica":376897},{"Age":77,"txM":350097,"roznica":350356},{"Age":78,"txM":308738,"roznica":323515},{"Age":79,"txM":270214,"roznica":296529},{"Age":80,"txM":234558,"roznica":269626},{"Age":81,"txM":201794,"roznica":243025},{"Age":82,"txM":171957,"roznica":216923},{"Age":83,"txM":145032,"roznica":191573},{"Age":84,"txM":120966,"roznica":167262},{"Age":85,"txM":99705,"roznica":144204},{"Age":86,"txM":81129,"roznica":122668},{"Age":87,"txM":65099,"roznica":102919},{"Age":88,"txM":51521,"roznica":84994},{"Age":89,"txM":40175,"roznica":68940},{"Age":90,"txM":30844,"roznica":54890},{"Age":91,"txM":23272,"roznica":42821},{"Age":92,"txM":17157,"roznica":32651},{"Age":93,"txM":12359,"roznica":24320},{"Age":94,"txM":8714,"roznica":17664},{"Age":95,"txM":6041,"roznica":12485},{"Age":96,"txM":4124,"roznica":8587},{"Age":97,"txM":2752,"roznica":5733},{"Age":98,"txM":1794,"roznica":3710},{"Age":99,"txM":1142,"roznica":2324}]
			var colors = ["blue", "red"];
			var margin = {top: 50, right: 0, bottom: 100, left: 120};
			var width = 1700 - margin.left - margin.right, height = 620 - margin.top - margin.bottom;
		 
			var svg = d3.select("body")
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				
			var dataset = d3.layout.stack()(["txM", "roznica"].map(function(t) {
				return data.map(function(d) {
					return {x: d.Age, y: +d[t]};
				});
			}));
			
			var x = d3.scale.ordinal()
				.domain(dataset[0].map(function(d) { return d.x; }))
				.rangeRoundBands([15, width], 0.07);
			
			var xAxis = d3.svg.axis()
				.scale(x)
				.orient("bottom")
			
			var y = d3.scale.linear()
				.domain([0, d3.max(dataset, function(d) {  return d3.max(d, function(d) { return d.y0 + d.y; }) + 600000;  })])
				.range([height, 0]);
		 
			var yAxis = d3.svg.axis()
				.scale(y)
				.orient("left")
				.ticks(17)
				.tickSize(40-width, 0, 0)
				.tickFormat( function(d) { return d } );
		 
			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis);
		 
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis)  .selectAll("text")	
				.style("text-anchor", "end")
				.attr("dx", ".5em")
				.attr("dy", ".190em")
		 
			var groups = svg.selectAll("g.cost")
				.data(dataset)
				.enter().append("g")
				.attr("class", "cost")
				.style("fill", function(d, i) { return colors[i]; });
		 
			var rect = groups.selectAll("rect")
				.data(function(d) { return d; })
				.enter()
				.append("rect")
				.attr("x", function(d) { return x(d.x); })
				.attr("y", function(d) { return y(d.y0 + d.y); })
				.attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); })
				.attr("width", x.rangeBand())
				.on("mouseover", function() { tooltip.style("display", null); })
				.on("mouseout", function() { tooltip.style("display", "none"); })
				.on("mousemove", function(d) {
					var xPosition = d3.mouse(this)[0] - 15;
					var yPosition = d3.mouse(this)[1] - 25;
					tooltip.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
					tooltip.select("text").text(d.y);
				})
				.on("click", function(d) {
					d3.select(this)
						.transition()
						.duration(1000)
						.attr('y', height)
						.attr('height', 0)
				});
				
			var tooltip = svg.append("g")
				.attr("class", "tooltip")
				.style("display", "none");
   
			tooltip.append("rect")
				.attr("width", 60)
				.attr("height", 20)
				.attr("fill", "white")
				.style("opacity", 0.5);
 
			tooltip.append("text")
				.attr("x", 30)
				.attr("dy", "1.2em")
				.style("text-anchor", "middle")
				.attr("font-size", "12px")
				.attr("font-weight", "bold");
			
			// Legenda
			var legend = svg.selectAll(".legend")
				.data(colors)
				.enter().append("g")
				.attr("class", "legend")
				.attr("transform", function(d, i) { return "translate(30," + i * 19 + ")"; });
 
			legend.append("rect")
				.attr("x", width - 255)
				.attr("width", 18)
				.attr("height", 18)
				.style("fill", function(d, i) {return colors.slice().reverse()[i];});
				
			legend.append("text")
				.attr("x", width - 230)
				.attr("y", 9)
				.attr("dy", ".35em")
				.style("text-anchor", "start")
				.text(function(d, i) {
					switch (i) {
						case 0: return "Kobiety (ile więcej niż mężczyzn)";
						case 1: return "Mężczyźni";
					}
				});
			
			// Nazwy osi i tytuł wykresu
			svg.append('text')
				.attr('class', 'title')
				.attr('x', 740)
				.attr('y', -20)
				.attr('font-size', 25)
				.attr('text-anchor', 'middle')
				.text('Liczba żyjących kobiet i mężczyzn w zależności od wieku')
			
			svg.append('text')
				.attr('class', 'label')
				.attr('x', 740)
				.attr('y', 520)
				.attr('font-size', 20)
				.attr('text-anchor', 'middle')
				.text('Wiek osób')
			
			svg.append('text')
				.attr('class', 'label')
				.attr('x', -230)
				.attr('y', -70)
				.attr('font-size', 20)
				.attr('transform', 'rotate(-90)')
				.attr('text-anchor', 'middle')
				.text('Liczba osób danego wieku')
            
            
        </script>
        
    </body>
</html>
